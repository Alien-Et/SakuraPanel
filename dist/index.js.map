{
  "version": 3,
  "sources": ["../utils/response.js", "../utils/auth.js", "../utils/nodes.js", "../utils/generate.js", "../utils/websocket.js", "../index.js"],
  "sourceRoot": "dist",
  "sourcesContent": ["// \u54CD\u5E94\u5DE5\u5177\u6A21\u5757\n\n/**\n * \u521B\u5EFA HTML \u54CD\u5E94\n * @param {string} \u5185\u5BB9 - HTML \u5185\u5BB9\n * @param {number} \u72B6\u6001\u7801 - HTTP \u72B6\u6001\u7801\uFF0C\u9ED8\u8BA4\u4E3A 200\n * @returns {Response} HTTP \u54CD\u5E94\u5BF9\u8C61\n */\nexport function createHTMLResponse(\u5185\u5BB9, \u72B6\u6001\u7801 = 200) {\n  return new Response(\u5185\u5BB9, {\n    status: \u72B6\u6001\u7801,\n    headers: {\n      \"Content-Type\": \"text/html;charset=utf-8\",\n      \"Cache-Control\": \"no-store, no-cache, must-revalidate, max-age=0\"\n    }\n  });\n}\n\n/**\n * \u521B\u5EFA\u91CD\u5B9A\u5411\u54CD\u5E94\n * @param {string} \u8DEF\u5F84 - \u91CD\u5B9A\u5411\u76EE\u6807\u8DEF\u5F84\n * @param {Object} \u989D\u5916\u5934 - \u989D\u5916\u7684 HTTP \u5934\u4FE1\u606F\n * @returns {Response} HTTP \u54CD\u5E94\u5BF9\u8C61\n */\nexport function createRedirectResponse(\u8DEF\u5F84, \u989D\u5916\u5934 = {}) {\n  return new Response(null, {\n    status: 302,\n    headers: {\n      \"Location\": \u8DEF\u5F84,\n      \"Cache-Control\": \"no-store, no-cache, must-revalidate, max-age=0\",\n      ...\u989D\u5916\u5934\n    }\n  });\n}\n\n/**\n * \u521B\u5EFA JSON \u54CD\u5E94\n * @param {*} \u6570\u636E - \u8981\u8FD4\u56DE\u7684 JSON \u6570\u636E\n * @param {number} \u72B6\u6001\u7801 - HTTP \u72B6\u6001\u7801\uFF0C\u9ED8\u8BA4\u4E3A 200\n * @param {Object} \u989D\u5916\u5934 - \u989D\u5916\u7684 HTTP \u5934\u4FE1\u606F\n * @returns {Response} HTTP \u54CD\u5E94\u5BF9\u8C61\n */\nexport function createJSONResponse(\u6570\u636E, \u72B6\u6001\u7801 = 200, \u989D\u5916\u5934 = {}) {\n  return new Response(JSON.stringify(\u6570\u636E), {\n    status: \u72B6\u6001\u7801,\n    headers: {\n      \"Content-Type\": \"application/json;charset=utf-8\",\n      \"Cache-Control\": \"no-store, no-cache, must-revalidate, max-age=0\",\n      ...\u989D\u5916\u5934\n    }\n  });\n}", "// \u8BA4\u8BC1\u5DE5\u5177\u6A21\u5757\n\n/**\n * \u68C0\u67E5\u8BBE\u5907\u9501\u5B9A\u72B6\u6001\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} \u8BBE\u5907\u6807\u8BC6 - \u552F\u4E00\u6807\u8BC6\u8BBE\u5907\u7684\u5B57\u7B26\u4E32\n * @param {number} \u9501\u5B9A\u65F6\u95F4 - \u9501\u5B9A\u65F6\u957F\uFF08\u6BEB\u79D2\uFF09\n * @returns {Object} \u9501\u5B9A\u72B6\u6001\u4FE1\u606F\n */\nexport async function checkLock(env, \u8BBE\u5907\u6807\u8BC6, \u9501\u5B9A\u65F6\u95F4) {\n  const \u9501\u5B9A\u65F6\u95F4\u6233 = await env.KV\u6570\u636E\u5E93.get(`lock_${\u8BBE\u5907\u6807\u8BC6}`);\n  const \u5F53\u524D\u65F6\u95F4 = Date.now();\n  const \u88AB\u9501\u5B9A = \u9501\u5B9A\u65F6\u95F4\u6233 && \u5F53\u524D\u65F6\u95F4 < Number(\u9501\u5B9A\u65F6\u95F4\u6233);\n  return {\n    \u88AB\u9501\u5B9A,\n    \u5269\u4F59\u65F6\u95F4: \u88AB\u9501\u5B9A ? Math.ceil((Number(\u9501\u5B9A\u65F6\u95F4\u6233) - \u5F53\u524D\u65F6\u95F4) / 1000) : 0\n  };\n}\n\n/**\n * \u751F\u6210\u767B\u5F55\u6CE8\u518C\u754C\u9762\n * @param {string} \u7C7B\u578B - '\u767B\u5F55' \u6216 '\u6CE8\u518C'\n * @param {Object} \u989D\u5916\u53C2\u6570 - \u989D\u5916\u7684\u754C\u9762\u53C2\u6570\n * @param {string} \u767D\u5929\u80CC\u666F\u56FE - \u767D\u5929\u6A21\u5F0F\u80CC\u666F\u56FEURL\n * @param {string} \u6697\u9ED1\u80CC\u666F\u56FE - \u6697\u9ED1\u6A21\u5F0F\u80CC\u666F\u56FEURL\n * @returns {string} HTML \u5185\u5BB9\n */\nexport function generateLoginRegisterPage(\u7C7B\u578B, \u989D\u5916\u53C2\u6570 = {}, \u767D\u5929\u80CC\u666F\u56FE, \u6697\u9ED1\u80CC\u666F\u56FE) {\n  const \u754C\u9762\u6570\u636E = {\n    \u6CE8\u518C: {\n      title: '\uD83C\uDF38\u9996\u6B21\u4F7F\u7528\u6CE8\u518C\uD83C\uDF38',\n      \u8868\u5355: `\n        <form class=\"auth-form\" action=\"/register/submit\" method=\"POST\" enctype=\"application/x-www-form-urlencoded\">\n          <input type=\"text\" name=\"username\" placeholder=\"\u8BBE\u7F6E\u8D26\u53F7\" required pattern=\"^[a-zA-Z0-9]{4,20}$\" title=\"4-20\u4F4D\u5B57\u6BCD\u6570\u5B57\">\n          <input type=\"password\" name=\"password\" placeholder=\"\u8BBE\u7F6E\u5BC6\u7801\" required minlength=\"6\">\n          <input type=\"password\" name=\"confirm\" placeholder=\"\u786E\u8BA4\u5BC6\u7801\" required>\n          <button type=\"submit\">\u7ACB\u5373\u6CE8\u518C</button>\n        </form>\n        ${\u989D\u5916\u53C2\u6570.\u9519\u8BEF\u4FE1\u606F ? `<div class=\"error-message\">${\u989D\u5916\u53C2\u6570.\u9519\u8BEF\u4FE1\u606F}</div>` : ''}\n      `\n    },\n    \u767B\u5F55: {\n      title: '\uD83C\uDF38\u6B22\u8FCE\u56DE\u6765\uD83C\uDF38',\n      \u8868\u5355: `\n        <form class=\"auth-form\" action=\"/login/submit\" method=\"POST\" enctype=\"application/x-www-form-urlencoded\">\n          <input type=\"text\" name=\"username\" placeholder=\"\u767B\u5F55\u8D26\u53F7\" required>\n          <input type=\"password\" name=\"password\" placeholder=\"\u767B\u5F55\u5BC6\u7801\" required>\n          <button type=\"submit\" id=\"loginButton\" ${\u989D\u5916\u53C2\u6570.\u9501\u5B9A\u72B6\u6001 ? 'disabled' : ''}>\u7ACB\u5373\u767B\u5F55</button>\n        </form>\n        ${\u989D\u5916\u53C2\u6570.\u8F93\u9519\u5BC6\u7801 ? `<div class=\"error-message\">\u5BC6\u7801\u9519\u8BEF\uFF0C\u5269\u4F59\u5C1D\u8BD5\u6B21\u6570\uFF1A${\u989D\u5916\u53C2\u6570.\u5269\u4F59\u6B21\u6570}</div>` : ''}\n        ${\u989D\u5916\u53C2\u6570.\u9501\u5B9A\u72B6\u6001 ? `\n          <div class=\"lock-message\">\n            \u8D26\u6237\u9501\u5B9A\uFF0C\u8BF7<span id=\"countdown\">${\u989D\u5916\u53C2\u6570.\u5269\u4F59\u65F6\u95F4}</span>\u79D2\u540E\u91CD\u8BD5\n          </div>` : ''}\n        ${\u989D\u5916\u53C2\u6570.\u9519\u8BEF\u4FE1\u606F ? `<div class=\"error-message\">${\u989D\u5916\u53C2\u6570.\u9519\u8BEF\u4FE1\u606F}</div>` : ''}\n      `\n    }\n  };\n\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    body {\n      font-family: 'Comic Sans MS', 'Arial', sans-serif;\n      color: #ff6f91;\n      margin: 0;\n      height: 100vh;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      position: relative;\n      overflow: hidden;\n      transition: background 0.5s ease;\n    }\n    @media (prefers-color-scheme: light) {\n      body { background: linear-gradient(135deg, #ffe6f0, #fff0f5); }\n      .auth-container { background: rgba(255, 245, 247, 0.9); box-shadow: 0 8px 20px rgba(255, 182, 193, 0.3); }\n    }\n    @media (prefers-color-scheme: dark) {\n      body { background: linear-gradient(135deg, #1e1e2f, #2a2a3b); }\n      .auth-container { background: rgba(30, 30, 30, 0.9); color: #ffd1dc; box-shadow: 0 8px 20px rgba(255, 133, 162, 0.2); }\n    }\n    .background-media {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      z-index: -1;\n      transition: opacity 0.5s ease;\n    }\n    .auth-container {\n      padding: 30px;\n      border-radius: 25px;\n      max-width: 400px;\n      width: 90%;\n      text-align: center;\n      position: relative;\n      z-index: 1;\n    }\n    h1 {\n      font-size: 1.8em;\n      color: #ff69b4;\n      margin-bottom: 20px;\n      text-shadow: 1px 1px 3px rgba(255, 105, 180, 0.2);\n    }\n    .auth-form {\n      display: flex;\n      flex-direction: column;\n      gap: 15px;\n      width: 100%;\n      max-width: 300px;\n      margin: 0 auto;\n    }\n    .auth-form input {\n      padding: 12px;\n      border-radius: 15px;\n      border: 2px solid #ffb6c1;\n      font-size: 1em;\n      width: 100%;\n      box-sizing: border-box;\n    }\n    .auth-form button {\n      padding: 12px;\n      background: linear-gradient(to right, #ffb6c1, #ff69b4);\n      color: white;\n      border: none;\n      border-radius: 20px;\n      cursor: pointer;\n      font-size: 1em;\n      transition: transform 0.3s ease, box-shadow 0.3s ease;\n    }\n    .auth-form button:hover {\n      transform: scale(1.05);\n      box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);\n    }\n    .auth-form button:active {\n      transform: scale(0.95);\n    }\n    .auth-form button:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n      box-shadow: none;\n      transform: none;\n    }\n    .error-message {\n      color: #ff6666;\n      margin-top: 15px;\n      font-size: 0.9em;\n    }\n    .lock-message {\n      color: #ff6666;\n      margin-top: 20px;\n      font-size: 1.1em;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 5px;\n    }\n    #countdown {\n      color: #ff1493;\n      font-weight: bold;\n      min-width: 50px;\n      text-align: center;\n    }\n    @media (max-width: 600px) {\n      .auth-container { padding: 20px; }\n      h1 { font-size: 1.5em; }\n      .auth-form input, .auth-form button { padding: 10px; font-size: 0.95em; }\n    }\n  </style>\n</head>\n<body>\n  <img id=\"backgroundImage\" class=\"background-media\">\n  <div class=\"auth-container\">\n    <h1>${\u754C\u9762\u6570\u636E[\u7C7B\u578B].title}</h1>\n    ${\u754C\u9762\u6570\u636E[\u7C7B\u578B].\u8868\u5355}\n  </div>\n  <script>\n    const lightBg = '${\u767D\u5929\u80CC\u666F\u56FE}';\n    const darkBg = '${\u6697\u9ED1\u80CC\u666F\u56FE}';\n    const bgImage = document.getElementById('backgroundImage');\n\n    function updateBackground() {\n      const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;\n      bgImage.src = isDarkMode ? darkBg : lightBg;\n      bgImage.onerror = () => { bgImage.style.display = 'none'; };\n    }\n    updateBackground();\n    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateBackground);\n\n    // \u5012\u8BA1\u65F6\u903B\u8F91\n    let remainingTime = ${\u989D\u5916\u53C2\u6570.\u9501\u5B9A\u72B6\u6001 ? \u989D\u5916\u53C2\u6570.\u5269\u4F59\u65F6\u95F4 : 0};\n    const countdownElement = document.getElementById('countdown');\n    const loginButton = document.getElementById('loginButton');\n\n    function startCountdown() {\n      if (!countdownElement) return;\n\n      const interval = setInterval(() => {\n        if (remainingTime <= 0) {\n          clearInterval(interval);\n          countdownElement.textContent = '0';\n          loginButton.disabled = false;\n          document.querySelector('.lock-message').textContent = '\u9501\u5B9A\u5DF2\u89E3\u9664\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5\u767B\u5F55';\n          fetch('/reset-login-failures', { method: 'POST' });\n          return;\n        }\n        countdownElement.textContent = remainingTime;\n        remainingTime--;\n      }, 1000);\n    }\n\n    function syncWithServer() {\n      fetch('/check-lock')\n        .then(response => response.json())\n        .then(data => {\n          if (data.locked) {\n            remainingTime = data.remainingTime;\n            countdownElement.textContent = remainingTime;\n            loginButton.disabled = true;\n          } else {\n            remainingTime = 0;\n            countdownElement.textContent = '0';\n            loginButton.disabled = false;\n            document.querySelector('.lock-message').textContent = '\u9501\u5B9A\u5DF2\u89E3\u9664\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5\u767B\u5F55';\n          }\n        })\n        .catch(error => {\n          console.error('\u540C\u6B65\u9501\u5B9A\u72B6\u6001\u5931\u8D25:', error);\n        });\n    }\n\n    if (${\u989D\u5916\u53C2\u6570.\u9501\u5B9A\u72B6\u6001}) {\n      startCountdown();\n      setInterval(syncWithServer, 10000);\n      document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n          syncWithServer();\n        }\n      });\n    }\n\n    // \u9632\u6B62 UA \u5207\u6362\u89E6\u53D1\u8868\u5355\u63D0\u4EA4\n    document.querySelector('.auth-form')?.addEventListener('submit', function(event) {\n      if (!event.isTrusted) {\n        event.preventDefault();\n        console.log('\u963B\u6B62\u975E\u7528\u6237\u89E6\u53D1\u7684\u8868\u5355\u63D0\u4EA4');\n      }\n    });\n\n    // \u76D1\u542C UA \u53D8\u5316\u5E76\u5E73\u6ED1\u5904\u7406\n    let lastUA = navigator.userAgent;\n    function checkUAChange() {\n      const currentUA = navigator.userAgent;\n      if (currentUA !== lastUA) {\n        console.log('UA \u5DF2\u5207\u6362\uFF0C\u4ECE', lastUA, '\u5230', currentUA);\n        lastUA = currentUA;\n      }\n    }\n    setInterval(checkUAChange, 500);\n  </script>\n</body>\n</html>\n  `;\n}\n\n/**\n * \u52A0\u5BC6\u5BC6\u7801\n * @param {string} \u5BC6\u7801 - \u8981\u52A0\u5BC6\u7684\u5BC6\u7801\n * @returns {Promise<string>} \u52A0\u5BC6\u540E\u7684\u5BC6\u7801\u54C8\u5E0C\u503C\n */\nexport async function encryptPassword(\u5BC6\u7801) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(\u5BC6\u7801);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}", "// \u8282\u70B9\u7BA1\u7406\u6A21\u5757\n\n/**\n * \u83B7\u53D6\u6216\u521D\u59CB\u5316 UUID\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @returns {Promise<string>} UUID \u5B57\u7B26\u4E32\n */\nexport async function getOrInitializeUUID(env) {\n  let uuid = await env.KV\u6570\u636E\u5E93.get('current_uuid');\n  if (!uuid) {\n    uuid = generateUUID();\n    await env.KV\u6570\u636E\u5E93.put('current_uuid', uuid);\n  }\n  return uuid;\n}\n\n/**\n * \u751F\u6210 UUID\n * @returns {string} UUID \u5B57\u7B26\u4E32\n */\nfunction generateUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n/**\n * \u52A0\u8F7D\u8282\u70B9\u548C\u914D\u7F6E\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @param {Array} preferredNodes - \u4F18\u9009\u8282\u70B9\u6570\u7EC4\uFF08\u5F15\u7528\uFF09\n * @param {string} nodeName - \u8282\u70B9\u540D\u79F0\n * @returns {Promise<void>}\n */\nexport async function loadNodesAndConfig(env, hostName, preferredNodes, nodeName) {\n  try {\n    const nodePathsCache = await env.KV\u6570\u636E\u5E93.get('node_file_paths');\n    let nodeFilePaths = nodePathsCache \n      ? JSON.parse(nodePathsCache) \n      : ['https://raw.githubusercontent.com/Alien-Et/SakuraPanel/refs/heads/main/ips.txt', 'https://raw.githubusercontent.com/Alien-Et/SakuraPanel/refs/heads/main/url.txt'];\n\n    const manualNodesCache = await env.KV\u6570\u636E\u5E93.get('manual_preferred_ips');\n    let manualNodeList = [];\n    if (manualNodesCache) {\n      manualNodeList = JSON.parse(manualNodesCache).map(line => line.trim()).filter(Boolean);\n    }\n\n    const responseList = await Promise.all(\n      nodeFilePaths.map(async (\u8DEF\u5F84) => {\n        try {\n          const response = await fetch(\u8DEF\u5F84);\n          if (!response.ok) throw new Error(`\u8BF7\u6C42 ${\u8DEF\u5F84} \u5931\u8D25\uFF0C\u72B6\u6001\u7801: ${response.status}`);\n          const text = await response.text();\n          return text.split('\\n').map(line => line.trim()).filter(Boolean);\n        } catch (\u9519\u8BEF) {\n          console.error(`\u62C9\u53D6 ${\u8DEF\u5F84} \u5931\u8D25: ${\u9519\u8BEF.message}`);\n          return [];\n        }\n      })\n    );\n\n    const domainNodeList = [...new Set(responseList.flat())];\n    const mergedNodeList = [...new Set([...manualNodeList, ...domainNodeList])];\n    const cachedNodes = await env.KV\u6570\u636E\u5E93.get('ip_preferred_ips');\n    const currentNodeList = cachedNodes ? JSON.parse(cachedNodes) : [];\n    const listsAreSame = JSON.stringify(mergedNodeList) === JSON.stringify(currentNodeList);\n\n    if (mergedNodeList.length > 0) {\n      // \u66F4\u65B0\u5F15\u7528\u6570\u7EC4\n      preferredNodes.length = 0;\n      mergedNodeList.forEach(node => preferredNodes.push(node));\n      \n      if (!listsAreSame) {\n        const newVersion = String(Date.now());\n        await env.KV\u6570\u636E\u5E93.put('ip_preferred_ips', JSON.stringify(mergedNodeList));\n        await env.KV\u6570\u636E\u5E93.put('ip_preferred_ips_version', newVersion);\n        // \u6CE8\u610F\uFF1A\u8FD9\u91CC\u4E0D\u76F4\u63A5\u8C03\u7528 generateCatConfig \u548C generateUniversalConfig\uFF0C\u800C\u662F\u8BA9\u8C03\u7528\u8005\u5904\u7406\n      }\n    } else {\n      // \u66F4\u65B0\u5F15\u7528\u6570\u7EC4\n      preferredNodes.length = 0;\n      (currentNodeList.length > 0 ? currentNodeList : [`${hostName}:443`]).forEach(node => preferredNodes.push(node));\n    }\n\n    await env.KV\u6570\u636E\u5E93.put('node_file_paths', JSON.stringify(nodeFilePaths));\n  } catch (\u9519\u8BEF) {\n    const cachedNodes = await env.KV\u6570\u636E\u5E93.get('ip_preferred_ips');\n    // \u66F4\u65B0\u5F15\u7528\u6570\u7EC4\n    preferredNodes.length = 0;\n    (cachedNodes ? JSON.parse(cachedNodes) : [`${hostName}:443`]).forEach(node => preferredNodes.push(node));\n    await env.KV\u6570\u636E\u5E93.put('ip_error_log', JSON.stringify({ time: Date.now(), error: '\u6240\u6709\u8DEF\u5F84\u62C9\u53D6\u5931\u8D25\u6216\u624B\u52A8\u4E0A\u4F20\u4E3A\u7A7A' }), { expirationTtl: 86400 });\n  }\n}\n\n/**\n * \u83B7\u53D6\u914D\u7F6E\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} type - \u914D\u7F6E\u7C7B\u578B\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @param {Function} generateConfigFunction - \u751F\u6210\u914D\u7F6E\u7684\u51FD\u6570\n * @returns {Promise<string>} \u914D\u7F6E\u5185\u5BB9\n */\nexport async function getConfig(env, type, hostName, generateConfigFunction) {\n  const cacheKey = type === atob('Y2xhc2g=') ? 'config_' + atob('Y2xhc2g=') : 'config_' + atob('djJyYXk=');\n  const versionKey = `${cacheKey}_version`;\n  const cachedConfig = await env.KV\u6570\u636E\u5E93.get(cacheKey);\n  const configVersion = await env.KV\u6570\u636E\u5E93.get(versionKey) || '0';\n  const nodeVersion = await env.KV\u6570\u636E\u5E93.get('ip_preferred_ips_version') || '0';\n\n  if (cachedConfig && configVersion === nodeVersion) {\n    return cachedConfig;\n  }\n\n  const newConfig = await generateConfigFunction(env, hostName);\n  await env.KV\u6570\u636E\u5E93.put(cacheKey, newConfig);\n  await env.KV\u6570\u636E\u5E93.put(versionKey, nodeVersion);\n  return newConfig;\n}", "// \u914D\u7F6E\u751F\u6210\u6A21\u5757\n\n/**\n * \u751F\u6210\u732B\u54AA\u914D\u7F6E\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @returns {Promise<string>} \u732B\u54AA\u914D\u7F6E\u5185\u5BB9\n */\nexport async function generateCatConfig(env, hostName) {\n  try {\n    const cachedNodes = await env.KV\u6570\u636E\u5E93.get('ip_preferred_ips');\n    const nodes = cachedNodes ? JSON.parse(cachedNodes) : [];\n    const currentNodeList = nodes.length > 0 ? nodes : [`${hostName}:443`];\n    const uuid = await env.KV\u6570\u636E\u5E93.get('current_uuid');\n    const domain = hostName.replace(/^[^.]+\\./, '');\n    const port = '443';\n\n    // \u56FD\u5BB6\u5206\u7EC4\u5904\u7406\n    const countryMap = new Map();\n    currentNodeList.forEach((node, index) => {\n      let country = 'CN';\n      let nodeName = node;\n      \n      // \u5C1D\u8BD5\u4ECE\u8282\u70B9\u4FE1\u606F\u4E2D\u63D0\u53D6\u56FD\u5BB6\u4EE3\u7801\n      if (node.includes('|')) {\n        const parts = node.split('|');\n        nodeName = parts[0];\n        if (parts.length > 1) {\n          country = parts[1];\n        }\n      }\n      \n      // \u8FC7\u6EE4\u6389\u65E0\u6548\u8282\u70B9\n      if (!nodeName || !nodeName.includes(':')) {\n        return;\n      }\n      \n      const nodeInfo = nodeName.split(':');\n      const nodeHost = nodeInfo[0];\n      const nodePort = nodeInfo.length > 1 ? nodeInfo[1] : port;\n      \n      const wsPath = `/ws?ed=2048`;\n      const userInfo = btoa(`${uuid}-${index}`);\n      const configLine = `${nodeHost}:${nodePort}#${domain}|${country}|${userInfo}|${btoa(wsPath)}`;\n      \n      if (!countryMap.has(country)) {\n        countryMap.set(country, []);\n      }\n      countryMap.get(country).push(configLine);\n    });\n\n    // \u751F\u6210\u914D\u7F6E\u5B57\u7B26\u4E32\n    let configContent = '';\n    const sortedCountries = Array.from(countryMap.keys()).sort();\n    \n    sortedCountries.forEach(country => {\n      const countryNodes = countryMap.get(country);\n      configContent += `[${country}]\\n${countryNodes.join('\\n')}\\n\\n`;\n    });\n\n    return configContent.trim();\n  } catch (error) {\n    console.error('\u751F\u6210\u732B\u54AA\u914D\u7F6E\u5931\u8D25:', error);\n    return '\u751F\u6210\u914D\u7F6E\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5';\n  }\n}\n\n/**\n * \u751F\u6210\u901A\u7528\u914D\u7F6E\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @returns {Promise<string>} \u901A\u7528\u914D\u7F6E\u5185\u5BB9\n */\nexport async function generateUniversalConfig(env, hostName) {\n  try {\n    const cachedNodes = await env.KV\u6570\u636E\u5E93.get('ip_preferred_ips');\n    const nodes = cachedNodes ? JSON.parse(cachedNodes) : [];\n    const currentNodeList = nodes.length > 0 ? nodes : [`${hostName}:443`];\n    const uuid = await env.KV\u6570\u636E\u5E93.get('current_uuid');\n    const domain = hostName;\n    \n    // \u5904\u7406\u6BCF\u4E2A\u8282\u70B9\n    const vmessConfigs = currentNodeList.map((node, index) => {\n      // \u89E3\u6790\u8282\u70B9\u4FE1\u606F\n      let nodeName = node;\n      let remark = '';\n      \n      if (node.includes('|')) {\n        const parts = node.split('|');\n        nodeName = parts[0];\n        if (parts.length > 1) {\n          remark = parts[1];\n        }\n      }\n      \n      // \u8FC7\u6EE4\u65E0\u6548\u8282\u70B9\n      if (!nodeName || !nodeName.includes(':')) {\n        return null;\n      }\n      \n      const nodeInfo = nodeName.split(':');\n      const nodeHost = nodeInfo[0];\n      const nodePort = parseInt(nodeInfo[1]) || 443;\n      \n      // \u751F\u6210VMess\u914D\u7F6E\u5BF9\u8C61\n      const vmessConfig = {\n        v: '2',\n        ps: `${domain}-${remark || '\u8282\u70B9'}-${index + 1}`,\n        add: nodeHost,\n        port: nodePort,\n        id: uuid,\n        aid: '0',\n        scy: 'auto',\n        net: 'ws',\n        type: 'none',\n        host: domain,\n        path: '/ws?ed=2048',\n        tls: 'tls',\n        sni: domain,\n        alpn: 'http/1.1',\n        fp: 'chrome'\n      };\n      \n      // \u8FD4\u56DEbase64\u7F16\u7801\u7684\u914D\u7F6E\n      return btoa(JSON.stringify(vmessConfig));\n    }).filter(Boolean);\n\n    // \u683C\u5F0F\u5316\u914D\u7F6E\u5B57\u7B26\u4E32\n    const configContent = vmessConfigs.join('\\n');\n    return configContent.trim();\n  } catch (error) {\n    console.error('\u751F\u6210\u901A\u7528\u914D\u7F6E\u5931\u8D25:', error);\n    return '\u751F\u6210\u914D\u7F6E\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5';\n  }\n}\n\n/**\n * \u751F\u6210\u8BA2\u9605\u9875\u9762\n * @param {string} uuid - \u7528\u6237UUID\n * @param {string} lightBgImage - \u6D45\u8272\u80CC\u666F\u56FEURL\n * @param {string} darkBgImage - \u6DF1\u8272\u80CC\u666F\u56FEURL\n * @returns {string} \u8BA2\u9605\u9875\u9762HTML\u5185\u5BB9\n */\nexport function generateSubscriptionPage(uuid, lightBgImage, darkBgImage) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"zh-CN\">\n    <head>\n      <meta charset=\"UTF-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <title>\uD83C\uDF38\u6A31\u82B1\u4EE3\u7406 - \u8BA2\u9605\u7BA1\u7406</title>\n      <style>\n        /* \u54CD\u5E94\u5F0FCSS\u6837\u5F0F */\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n          font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;\n          min-height: 100vh;\n          background-size: cover;\n          background-position: center;\n          background-attachment: fixed;\n          transition: background-image 0.5s ease;\n          padding: 20px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        .container {\n          max-width: 600px;\n          width: 100%;\n          background: rgba(255, 255, 255, 0.1);\n          backdrop-filter: blur(10px);\n          border-radius: 20px;\n          padding: 40px;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n          border: 1px solid rgba(255, 255, 255, 0.2);\n        }\n        h1, h2 {\n          color: #333;\n          text-align: center;\n          margin-bottom: 20px;\n          text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);\n        }\n        h1 { font-size: 2.5rem; color: #ff6b6b; }\n        h2 { font-size: 1.5rem; margin-top: 30px; }\n        .uuid-display {\n          background: rgba(255, 255, 255, 0.8);\n          padding: 20px;\n          border-radius: 10px;\n          font-family: 'Courier New', monospace;\n          word-break: break-all;\n          margin: 20px 0;\n          position: relative;\n        }\n        .copy-btn {\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          background: #ff6b6b;\n          color: white;\n          border: none;\n          padding: 5px 15px;\n          border-radius: 5px;\n          cursor: pointer;\n          font-size: 14px;\n          transition: background 0.3s;\n        }\n        .copy-btn:hover { background: #ff5252; }\n        .config-section {\n          margin: 30px 0;\n        }\n        .config-item {\n          background: rgba(255, 255, 255, 0.8);\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 15px;\n          transition: transform 0.3s;\n        }\n        .config-item:hover { transform: translateY(-5px); }\n        .config-item h3 {\n          color: #333;\n          margin-bottom: 10px;\n          display: flex;\n          align-items: center;\n        }\n        .config-item h3 i {\n          margin-right: 10px;\n          color: #ff6b6b;\n        }\n        .config-url {\n          font-family: 'Courier New', monospace;\n          background: rgba(0, 0, 0, 0.05);\n          padding: 10px;\n          border-radius: 5px;\n          word-break: break-all;\n          margin: 10px 0;\n        }\n        .action-btn {\n          background: #4CAF50;\n          color: white;\n          border: none;\n          padding: 10px 20px;\n          border-radius: 5px;\n          cursor: pointer;\n          font-size: 16px;\n          margin-right: 10px;\n          transition: background 0.3s;\n        }\n        .action-btn:hover { background: #45a049; }\n        .danger-btn {\n          background: #f44336;\n        }\n        .danger-btn:hover { background: #d32f2f; }\n        .btn-group {\n          display: flex;\n          justify-content: center;\n          margin-top: 30px;\n        }\n        .toggle-theme {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: rgba(255, 255, 255, 0.3);\n          border: none;\n          border-radius: 50%;\n          width: 50px;\n          height: 50px;\n          cursor: pointer;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          font-size: 24px;\n          transition: background 0.3s;\n        }\n        .toggle-theme:hover { background: rgba(255, 255, 255, 0.5); }\n        \n        /* \u79FB\u52A8\u7AEF\u9002\u914D */\n        @media (max-width: 600px) {\n          body { padding: 10px; }\n          .container { padding: 20px; }\n          h1 { font-size: 2rem; }\n          h2 { font-size: 1.2rem; }\n          .action-btn {\n            display: block;\n            width: 100%;\n            margin: 10px 0;\n          }\n          .btn-group { flex-direction: column; }\n        }\n      </style>\n    </head>\n    <body id=\"subscription-page\">\n      <button class=\"toggle-theme\" id=\"theme-toggle\">\uD83C\uDF19</button>\n      \n      <div class=\"container\">\n        <h1>\uD83C\uDF38\u6A31\u82B1\u4EE3\u7406</h1>\n        <h2>\u8BA2\u9605\u7BA1\u7406\u4E2D\u5FC3</h2>\n        \n        <div class=\"uuid-display\">\n          <span>\u5F53\u524DUUID\uFF1A${uuid}</span>\n          <button class=\"copy-btn\" onclick=\"copyToClipboard('${uuid}')\">\u590D\u5236</button>\n        </div>\n        \n        <div class=\"config-section\">\n          <h3>\u914D\u7F6E\u94FE\u63A5</h3>\n          \n          <div class=\"config-item\">\n            <h3>\uD83D\uDC31 \u732B\u54AA\u914D\u7F6E</h3>\n            <div class=\"config-url\" id=\"cat-config-url\">https://${location.hostname}/config/cat?uuid=${uuid}</div>\n            <div class=\"btn-group\">\n              <button class=\"action-btn\" onclick=\"copyToClipboard(document.getElementById('cat-config-url').textContent)\">\u590D\u5236\u94FE\u63A5</button>\n              <a href=\"https://${location.hostname}/config/cat?uuid=${uuid}\" target=\"_blank\" class=\"action-btn\">\u6253\u5F00</a>\n            </div>\n          </div>\n          \n          <div class=\"config-item\">\n            <h3>\uD83C\uDF10 \u901A\u7528\u914D\u7F6E</h3>\n            <div class=\"config-url\" id=\"universal-config-url\">https://${location.hostname}/config/universal?uuid=${uuid}</div>\n            <div class=\"btn-group\">\n              <button class=\"action-btn\" onclick=\"copyToClipboard(document.getElementById('universal-config-url').textContent)\">\u590D\u5236\u94FE\u63A5</button>\n              <a href=\"https://${location.hostname}/config/universal?uuid=${uuid}\" target=\"_blank\" class=\"action-btn\">\u6253\u5F00</a>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"btn-group\">\n          <button class=\"action-btn\" onclick=\"location.href='/update-uuid'\">\u66F4\u6362UUID</button>\n          <button class=\"action-btn\" onclick=\"location.href='/proxy-settings'\">\u4EE3\u7406\u8BBE\u7F6E</button>\n          <button class=\"action-btn danger-btn\" onclick=\"location.href='/logout'\">\u9000\u51FA\u767B\u5F55</button>\n        </div>\n      </div>\n      \n      <script>\n        // \u5207\u6362\u4E3B\u9898\n        const themeToggle = document.getElementById('theme-toggle');\n        const subscriptionPage = document.getElementById('subscription-page');\n        \n        // \u521D\u59CB\u5316\u4E3B\u9898\n        function initTheme() {\n          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\n          const savedTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');\n          \n          if (savedTheme === 'dark') {\n            subscriptionPage.style.backgroundImage = 'url(${darkBgImage})';\n            themeToggle.textContent = '\u2600\uFE0F';\n          } else {\n            subscriptionPage.style.backgroundImage = 'url(${lightBgImage})';\n            themeToggle.textContent = '\uD83C\uDF19';\n          }\n        }\n        \n        // \u5207\u6362\u4E3B\u9898\u4E8B\u4EF6\n        themeToggle.addEventListener('click', () => {\n          const currentTheme = localStorage.getItem('theme') || 'light';\n          const newTheme = currentTheme === 'light' ? 'dark' : 'light';\n          \n          localStorage.setItem('theme', newTheme);\n          \n          if (newTheme === 'dark') {\n            subscriptionPage.style.backgroundImage = 'url(${darkBgImage})';\n            themeToggle.textContent = '\u2600\uFE0F';\n          } else {\n            subscriptionPage.style.backgroundImage = 'url(${lightBgImage})';\n            themeToggle.textContent = '\uD83C\uDF19';\n          }\n        });\n        \n        // \u590D\u5236\u5230\u526A\u8D34\u677F\n        function copyToClipboard(text) {\n          navigator.clipboard.writeText(text)\n            .then(() => {\n              const btn = event.target;\n              const originalText = btn.textContent;\n              btn.textContent = '\u5DF2\u590D\u5236!';\n              setTimeout(() => {\n                btn.textContent = originalText;\n              }, 2000);\n            })\n            .catch(err => {\n              console.error('\u590D\u5236\u5931\u8D25:', err);\n            });\n        }\n        \n        // \u68C0\u6D4B\u7528\u6237\u4EE3\u7406\n        function detectUserAgent() {\n          const ua = navigator.userAgent;\n          const isMobile = /Mobile|Android|iOS|iPhone|iPad|iPod/i.test(ua);\n          \n          if (isMobile) {\n            document.body.style.fontSize = '14px';\n          }\n        }\n        \n        // \u9875\u9762\u52A0\u8F7D\u65F6\u6267\u884C\n        window.addEventListener('load', () => {\n          initTheme();\n          detectUserAgent();\n        });\n        \n        // \u7A97\u53E3\u5927\u5C0F\u53D8\u5316\u65F6\u91CD\u65B0\u68C0\u6D4B\n        window.addEventListener('resize', detectUserAgent);\n      </script>\n    </body>\n    </html>\n  `;\n}\n\n/**\n * \u751F\u6210KV\u672A\u7ED1\u5B9A\u63D0\u793A\u9875\u9762\n * @param {string} lightBgImage - \u6D45\u8272\u80CC\u666F\u56FEURL\n * @param {string} darkBgImage - \u6DF1\u8272\u80CC\u666F\u56FEURL\n * @returns {string} KV\u672A\u7ED1\u5B9A\u63D0\u793A\u9875\u9762HTML\u5185\u5BB9\n */\nexport function generateKvNotBoundPage(lightBgImage, darkBgImage) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"zh-CN\">\n    <head>\n      <meta charset=\"UTF-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <title>\uD83C\uDF38\u6A31\u82B1\u4EE3\u7406 - \u914D\u7F6E\u9519\u8BEF</title>\n      <style>\n        /* \u54CD\u5E94\u5F0FCSS\u6837\u5F0F */\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n          font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;\n          min-height: 100vh;\n          background-size: cover;\n          background-position: center;\n          background-attachment: fixed;\n          transition: background-image 0.5s ease;\n          padding: 20px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        .container {\n          max-width: 600px;\n          width: 100%;\n          background: rgba(255, 255, 255, 0.1);\n          backdrop-filter: blur(10px);\n          border-radius: 20px;\n          padding: 40px;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n          border: 1px solid rgba(255, 255, 255, 0.2);\n          text-align: center;\n        }\n        h1 {\n          color: #ff6b6b;\n          font-size: 2.5rem;\n          margin-bottom: 20px;\n          text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);\n        }\n        p {\n          color: #333;\n          font-size: 1.2rem;\n          margin-bottom: 20px;\n          line-height: 1.6;\n        }\n        .error-code {\n          font-family: 'Courier New', monospace;\n          background: rgba(255, 0, 0, 0.1);\n          padding: 10px;\n          border-radius: 5px;\n          margin: 20px 0;\n          font-size: 18px;\n        }\n        .instructions {\n          text-align: left;\n          background: rgba(255, 255, 255, 0.8);\n          padding: 20px;\n          border-radius: 10px;\n          margin: 20px 0;\n        }\n        .instructions ol {\n          margin-left: 20px;\n        }\n        .instructions li {\n          margin-bottom: 10px;\n        }\n        .toggle-theme {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: rgba(255, 255, 255, 0.3);\n          border: none;\n          border-radius: 50%;\n          width: 50px;\n          height: 50px;\n          cursor: pointer;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          font-size: 24px;\n          transition: background 0.3s;\n        }\n        .toggle-theme:hover { background: rgba(255, 255, 255, 0.5); }\n        \n        /* \u79FB\u52A8\u7AEF\u9002\u914D */\n        @media (max-width: 600px) {\n          body { padding: 10px; }\n          .container { padding: 20px; }\n          h1 { font-size: 2rem; }\n          p { font-size: 1rem; }\n        }\n      </style>\n    </head>\n    <body id=\"kv-error-page\">\n      <button class=\"toggle-theme\" id=\"theme-toggle\">\uD83C\uDF19</button>\n      \n      <div class=\"container\">\n        <h1>\u26A0\uFE0F \u914D\u7F6E\u9519\u8BEF</h1>\n        <p>\u65E0\u6CD5\u4F7F\u7528\u6A31\u82B1\u4EE3\u7406\u9762\u677F\uFF0C\u56E0\u4E3A\u672A\u6B63\u786E\u7ED1\u5B9AKV\u6570\u636E\u5E93\u3002</p>\n        \n        <div class=\"error-code\">\u9519\u8BEF\u4EE3\u7801: KV_DATABASE_NOT_BOUND</div>\n        \n        <div class=\"instructions\">\n          <h3>\u89E3\u51B3\u65B9\u6CD5:</h3>\n          <ol>\n            <li>\u767B\u5F55\u5230 Cloudflare \u63A7\u5236\u53F0</li>\n            <li>\u521B\u5EFA\u4E00\u4E2A KV \u547D\u540D\u7A7A\u95F4</li>\n            <li>\u5728 Workers \u8BBE\u7F6E\u4E2D\uFF0C\u5C06 KV \u547D\u540D\u7A7A\u95F4\u7ED1\u5B9A\u5230\u60A8\u7684 Worker</li>\n            <li>\u786E\u4FDD\u7ED1\u5B9A\u540D\u79F0\u4E3A <strong>KV\u6570\u636E\u5E93</strong></li>\n            <li>\u91CD\u65B0\u90E8\u7F72\u60A8\u7684 Worker</li>\n          </ol>\n        </div>\n        \n        <p>\u5B8C\u6210\u4E0A\u8FF0\u6B65\u9AA4\u540E\uFF0C\u5237\u65B0\u6B64\u9875\u9762\u5373\u53EF\u6B63\u5E38\u4F7F\u7528\u6A31\u82B1\u4EE3\u7406\u9762\u677F\u3002</p>\n      </div>\n      \n      <script>\n        // \u5207\u6362\u4E3B\u9898\n        const themeToggle = document.getElementById('theme-toggle');\n        const kvErrorPage = document.getElementById('kv-error-page');\n        \n        // \u521D\u59CB\u5316\u4E3B\u9898\n        function initTheme() {\n          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\n          const savedTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');\n          \n          if (savedTheme === 'dark') {\n            kvErrorPage.style.backgroundImage = 'url(${darkBgImage})';\n            themeToggle.textContent = '\u2600\uFE0F';\n          } else {\n            kvErrorPage.style.backgroundImage = 'url(${lightBgImage})';\n            themeToggle.textContent = '\uD83C\uDF19';\n          }\n        }\n        \n        // \u5207\u6362\u4E3B\u9898\u4E8B\u4EF6\n        themeToggle.addEventListener('click', () => {\n          const currentTheme = localStorage.getItem('theme') || 'light';\n          const newTheme = currentTheme === 'light' ? 'dark' : 'light';\n          \n          localStorage.setItem('theme', newTheme);\n          \n          if (newTheme === 'dark') {\n            kvErrorPage.style.backgroundImage = 'url(${darkBgImage})';\n            themeToggle.textContent = '\u2600\uFE0F';\n          } else {\n            kvErrorPage.style.backgroundImage = 'url(${lightBgImage})';\n            themeToggle.textContent = '\uD83C\uDF19';\n          }\n        });\n        \n        // \u9875\u9762\u52A0\u8F7D\u65F6\u6267\u884C\n        window.addEventListener('load', initTheme);\n      </script>\n    </body>\n    </html>\n  `;\n}", "// WebSocket \u5904\u7406\u6A21\u5757\n\n/**\n * \u5904\u7406 WebSocket \u5347\u7EA7\u8BF7\u6C42\n * @param {Request} request - \u5BA2\u6237\u7AEF\u8BF7\u6C42\u5BF9\u8C61\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @param {Array} preferredNodes - \u4F18\u9009\u8282\u70B9\u6570\u7EC4\n * @returns {Promise<Response>} WebSocket \u54CD\u5E94\n */\nexport async function handleWebSocketUpgrade(request, env, hostName, preferredNodes) {\n  try {\n    // \u9A8C\u8BC1\u8BF7\u6C42\u662F\u5426\u5305\u542B\u5FC5\u8981\u7684\u8BA4\u8BC1\u4FE1\u606F\n    const authHeader = request.headers.get('Authorization') || '';\n    const uuid = await env.KV\u6570\u636E\u5E93.get('current_uuid');\n    \n    // \u68C0\u67E5\u8BA4\u8BC1\n    if (!authHeader.includes(uuid) && !isProxyRequestPath(request)) {\n      // \u5C1D\u8BD5\u4ECE URL \u53C2\u6570\u4E2D\u83B7\u53D6 UUID\n      const url = new URL(request.url);\n      if (!url.searchParams.get('uuid') || url.searchParams.get('uuid') !== uuid) {\n        return new Response('Unauthorized', { status: 401 });\n      }\n    }\n\n    // \u667A\u80FD\u8FDE\u63A5\u5230\u8282\u70B9\n    const { conn, selectedNode } = await connectToNode(preferredNodes, hostName);\n    \n    if (!conn) {\n      throw new Error('\u65E0\u6CD5\u8FDE\u63A5\u5230\u4EFB\u4F55\u8282\u70B9');\n    }\n\n    // \u521B\u5EFA\u670D\u52A1\u5668\u7AEF WebSocket\n    const { socket, response } = Deno.upgradeWebSocket(request);\n    \n    // WebSocket \u4E8B\u4EF6\u5904\u7406\n    handleWebSocketEvents(socket, conn);\n\n    console.log(`WebSocket \u8FDE\u63A5\u5DF2\u5EFA\u7ACB\u5230\u8282\u70B9: ${selectedNode}`);\n    return response;\n  } catch (error) {\n    console.error('WebSocket \u5347\u7EA7\u5931\u8D25:', error);\n    return new Response('WebSocket \u5347\u7EA7\u5931\u8D25', { status: 500 });\n  }\n}\n\n/**\n * \u68C0\u67E5\u8BF7\u6C42\u8DEF\u5F84\u662F\u5426\u4E3A\u4EE3\u7406\u8DEF\u5F84\n * @param {Request} request - \u5BA2\u6237\u7AEF\u8BF7\u6C42\u5BF9\u8C61\n * @returns {boolean} \u662F\u5426\u4E3A\u4EE3\u7406\u8DEF\u5F84\n */\nfunction isProxyRequestPath(request) {\n  const url = new URL(request.url);\n  return url.pathname === '/ws' || url.pathname === '/socks5';\n}\n\n/**\n * \u667A\u80FD\u8FDE\u63A5\u5230\u8282\u70B9\n * @param {Array} preferredNodes - \u4F18\u9009\u8282\u70B9\u6570\u7EC4\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @returns {Promise<{conn: WebSocket, selectedNode: string}>} \u8FDE\u63A5\u548C\u9009\u4E2D\u7684\u8282\u70B9\n */\nasync function connectToNode(preferredNodes, hostName) {\n  for (const node of [...preferredNodes, `${hostName}:443`]) {\n    try {\n      const nodeParts = node.split(':');\n      const nodeHost = nodeParts[0];\n      const nodePort = parseInt(nodeParts[1]) || 443;\n      const wsUrl = `wss://${nodeHost}:${nodePort}/ws?ed=2048`;\n      \n      // \u5C1D\u8BD5\u8FDE\u63A5\u5230\u8282\u70B9\n      const conn = await new Promise((resolve, reject) => {\n        const ws = new WebSocket(wsUrl);\n        ws.onopen = () => resolve(ws);\n        ws.onerror = reject;\n        ws.onclose = () => reject(new Error('\u8FDE\u63A5\u5173\u95ED'));\n        // \u8BBE\u7F6E\u8D85\u65F6\n        setTimeout(() => reject(new Error('\u8FDE\u63A5\u8D85\u65F6')), 5000);\n      });\n      \n      return { conn, selectedNode: node };\n    } catch (error) {\n      console.warn(`\u8FDE\u63A5\u5230\u8282\u70B9 ${node} \u5931\u8D25: ${error.message}`);\n      // \u7EE7\u7EED\u5C1D\u8BD5\u4E0B\u4E00\u4E2A\u8282\u70B9\n    }\n  }\n  \n  // \u6240\u6709\u8282\u70B9\u90FD\u8FDE\u63A5\u5931\u8D25\n  throw new Error('\u6240\u6709\u8282\u70B9\u8FDE\u63A5\u5931\u8D25');\n}\n\n/**\n * \u5904\u7406 WebSocket \u4E8B\u4EF6\n * @param {WebSocket} socket - \u670D\u52A1\u5668\u7AEF WebSocket\n * @param {WebSocket} conn - \u5230\u76EE\u6807\u8282\u70B9\u7684 WebSocket \u8FDE\u63A5\n */\nfunction handleWebSocketEvents(socket, conn) {\n  // \u5BA2\u6237\u7AEF\u6D88\u606F -> \u76EE\u6807\u8282\u70B9\n  socket.onmessage = event => {\n    if (conn && conn.readyState === WebSocket.OPEN) {\n      conn.send(event.data);\n    }\n  };\n  \n  // \u76EE\u6807\u8282\u70B9\u6D88\u606F -> \u5BA2\u6237\u7AEF\n  conn.onmessage = event => {\n    if (socket.readyState === WebSocket.OPEN) {\n      socket.send(event.data);\n    }\n  };\n  \n  // \u5BA2\u6237\u7AEF\u5173\u95ED -> \u5173\u95ED\u76EE\u6807\u8282\u70B9\u8FDE\u63A5\n  socket.onclose = () => {\n    if (conn && conn.readyState !== WebSocket.CLOSED) {\n      conn.close();\n    }\n  };\n  \n  // \u76EE\u6807\u8282\u70B9\u5173\u95ED -> \u5173\u95ED\u5BA2\u6237\u7AEF\u8FDE\u63A5\n  conn.onclose = () => {\n    if (socket.readyState !== WebSocket.CLOSED) {\n      socket.close();\n    }\n  };\n  \n  // \u9519\u8BEF\u5904\u7406\n  socket.onerror = error => {\n    console.error('\u5BA2\u6237\u7AEF WebSocket \u9519\u8BEF:', error);\n  };\n  \n  conn.onerror = error => {\n    console.error('\u76EE\u6807\u8282\u70B9 WebSocket \u9519\u8BEF:', error);\n  };\n}\n\n/**\n * \u5904\u7406 SOCKS5 \u8FDE\u63A5\n * @param {Request} request - \u5BA2\u6237\u7AEF\u8BF7\u6C42\u5BF9\u8C61\n * @param {Object} env - Cloudflare Workers \u73AF\u5883\u5BF9\u8C61\n * @param {string} hostName - \u4E3B\u673A\u540D\n * @returns {Promise<Response>} SOCKS5 \u8FDE\u63A5\u54CD\u5E94\n */\nexport async function handleSocks5Connection(request, env, hostName) {\n  try {\n    // \u89E3\u6790\u8D26\u53F7\u548C\u5BC6\u7801\n    const authHeader = request.headers.get('Proxy-Authorization') || '';\n    const uuid = await env.KV\u6570\u636E\u5E93.get('current_uuid');\n    \n    // \u68C0\u67E5\u8BA4\u8BC1\n    if (!authHeader.includes(btoa(uuid)) && !authHeader.includes(uuid)) {\n      // \u5C1D\u8BD5\u4ECE URL \u53C2\u6570\u4E2D\u83B7\u53D6\u8BA4\u8BC1\u4FE1\u606F\n      const url = new URL(request.url);\n      if (!url.searchParams.get('uuid') || url.searchParams.get('uuid') !== uuid) {\n        return new Response('Unauthorized', { status: 401 });\n      }\n    }\n\n    // \u521B\u5EFA SOCKS5 \u63E1\u624B\u54CD\u5E94\n    const upgradeHeaders = request.headers;\n    \n    // \u83B7\u53D6 SOCKS5 \u670D\u52A1\u5668\u5730\u5740\uFF08\u4ECE\u73AF\u5883\u53D8\u91CF\u6216\u9ED8\u8BA4\u503C\uFF09\n    const socks5Server = env.SOCKS5 || `${hostName}:443`;\n    \n    // \u8FDE\u63A5\u5230 SOCKS5 \u670D\u52A1\u5668\n    const conn = await fetch(`wss://${socks5Server}/socks5`, {\n      method: 'GET',\n      headers: upgradeHeaders,\n      cf: {\n        cacheTtl: 0,\n        cacheEverything: false,\n        connectTimeout: 5000\n      }\n    });\n\n    // \u8FD4\u56DE SOCKS5 \u8FDE\u63A5\u54CD\u5E94\n    return new Response(conn.body, {\n      status: conn.status,\n      headers: conn.headers\n    });\n  } catch (error) {\n    console.error('SOCKS5 \u8FDE\u63A5\u5931\u8D25:', error);\n    return new Response('SOCKS5 \u8FDE\u63A5\u5931\u8D25', { status: 500 });\n  }\n}\n\n/**\n * \u5EFA\u7ACB\u7BA1\u9053\u8FDE\u63A5\n * @param {ReadableStream} source - \u6E90\u6570\u636E\u6D41\n * @param {WritableStream} destination - \u76EE\u6807\u6570\u636E\u6D41\n * @param {Function} onError - \u9519\u8BEF\u5904\u7406\u51FD\u6570\n * @returns {Promise<void>} \u7BA1\u9053\u5B8C\u6210\u7684 Promise\n */\nexport async function pipeStreams(source, destination, onError) {\n  try {\n    await source.pipeTo(destination, { preventClose: true });\n  } catch (error) {\n    if (onError) {\n      onError(error);\n    } else {\n      console.error('\u7BA1\u9053\u5EFA\u7ACB\u5931\u8D25:', error);\n    }\n  }\n}", "import { createHTMLResponse, createRedirectResponse, createJSONResponse } from './utils/response.js';\nimport { checkLock, generateLoginRegisterPage, encryptPassword } from './utils/auth.js';\nimport { loadNodesAndConfig, getConfig, getOrInitializeUUID } from './utils/nodes.js';\nimport { generateSubscriptionPage, generateKvNotBoundPage, generateCatConfig, generateUniversalConfig } from './utils/generate.js';\nimport { handleWebSocketUpgrade, handleSocks5Connection } from './utils/websocket.js';\n\n// \u57FA\u7840\u914D\u7F6E\nconst CONFIG_PATH = \"config\";\nlet PREFERRED_NODES = [];\nlet PROXY_ADDRESS = 'ts.hpc.tw';\nlet SOCKS5_ACCOUNT = '';\nlet NODE_NAME = '\uD83C\uDF38\u6A31\u82B1';\nlet FAKE_DOMAIN = 'lkssite.vip';\nlet MAX_FAILURES = 5;\nlet LOCK_TIME = 5 * 60 * 1000;\nlet LIGHT_BG_IMAGE = 'https://i.meee.com.tw/el91luR.png';\nlet DARK_BG_IMAGE = 'https://i.meee.com.tw/QPWx8nX.png';\n\nexport default {\n  async fetch(request, env) {\n    try {\n      // \u4ECE\u73AF\u5883\u53D8\u91CF\u8BFB\u53D6\u914D\u7F6E\n      PROXY_ADDRESS = env.PROXYIP || PROXY_ADDRESS;\n      SOCKS5_ACCOUNT = env.SOCKS5 || SOCKS5_ACCOUNT;\n      \n      if (!env.KV\u6570\u636E\u5E93) {\n        return createHTMLResponse(generateKvNotBoundPage(LIGHT_BG_IMAGE, DARK_BG_IMAGE));\n      }\n\n      const upgradeHeader = request.headers.get('Upgrade');\n      const url = new URL(request.url);\n      const hostName = request.headers.get('Host');\n      const UA = request.headers.get('User-Agent') || 'unknown';\n      const IP = request.headers.get('CF-Connecting-IP') || 'unknown';\n      const deviceId = `${UA}_${IP}`;\n      let formData;\n\n      // WebSocket \u5904\u7406\n      if (upgradeHeader && upgradeHeader === 'websocket') {\n        await loadNodesAndConfig(env, hostName, PREFERRED_NODES, NODE_NAME);\n        return await handleWebSocketUpgrade(request, env, hostName, PREFERRED_NODES);\n      }\n\n      // \u8868\u5355\u6570\u636E\u5904\u7406\n      if (url.pathname === '/login/submit' || url.pathname === '/register/submit') {\n        const contentType = request.headers.get('Content-Type') || '';\n        if (!contentType.includes('application/x-www-form-urlencoded') && !contentType.includes('multipart/form-data')) {\n          console.log(`\u65E0\u6548\u8BF7\u6C42: UA=${UA}, IP=${IP}, Path=${url.pathname}, Headers=${JSON.stringify([...request.headers])}`);\n          return createHTMLResponse(generateLoginRegisterPage(url.pathname === '/login/submit' ? '\u767B\u5F55' : '\u6CE8\u518C', {\n            \u9519\u8BEF\u4FE1\u606F: '\u8BF7\u901A\u8FC7\u6B63\u5E38\u8868\u5355\u63D0\u4EA4'\n          }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 400);\n        }\n\n        try {\n          formData = await request.formData();\n        } catch (error) {\n          return createHTMLResponse(generateLoginRegisterPage(url.pathname === '/login/submit' ? '\u767B\u5F55' : '\u6CE8\u518C', {\n            \u9519\u8BEF\u4FE1\u606F: '\u63D0\u4EA4\u6570\u636E\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5'\n          }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 400);\n        }\n      }\n\n      // \u6CE8\u518C\u5904\u7406\n      if (url.pathname === '/register/submit') {\n        const username = formData.get('username');\n        const password = formData.get('password');\n        const confirmPassword = formData.get('confirm');\n\n        if (!username || !password || password !== confirmPassword) {\n          return createHTMLResponse(generateLoginRegisterPage('\u6CE8\u518C', {\n            \u9519\u8BEF\u4FE1\u606F: password !== confirmPassword ? '\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4' : '\u8BF7\u586B\u5199\u5B8C\u6574\u4FE1\u606F'\n          }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 400);\n        }\n\n        const existingUser = await env.KV\u6570\u636E\u5E93.get('stored_credentials');\n        if (existingUser) {\n          return createRedirectResponse('/login');\n        }\n\n        const encryptedPassword = await encryptPassword(password);\n        await env.KV\u6570\u636E\u5E93.put('stored_credentials', JSON.stringify({\n          username, password: encryptedPassword\n        }));\n\n        const newToken = Math.random().toString(36).substring(2);\n        await env.KV\u6570\u636E\u5E93.put('current_token', newToken, { expirationTtl: 300 });\n        return createRedirectResponse(`/${CONFIG_PATH}`, {\n          'Set-Cookie': `token=${newToken}; Path=/; HttpOnly; SameSite=Strict`\n        });\n      }\n\n      // \u767B\u5F55\u5904\u7406\n      if (url.pathname === '/login/submit') {\n        const lockStatus = await checkLock(env, deviceId, LOCK_TIME);\n        if (lockStatus.\u88AB\u9501\u5B9A) {\n          return createHTMLResponse(generateLoginRegisterPage('\u767B\u5F55', {\n            \u9501\u5B9A\u72B6\u6001: true,\n            \u5269\u4F59\u65F6\u95F4: lockStatus.\u5269\u4F59\u65F6\u95F4\n          }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 403);\n        }\n\n        const storedCredentials = await env.KV\u6570\u636E\u5E93.get('stored_credentials');\n        if (!storedCredentials) {\n          return createRedirectResponse('/register');\n        }\n\n        const inputUsername = formData.get('username');\n        const inputPassword = formData.get('password');\n\n        const credentialsObj = JSON.parse(storedCredentials || '{}');\n        const passwordMatch = (await encryptPassword(inputPassword)) === credentialsObj.password;\n        if (inputUsername === credentialsObj.username && passwordMatch) {\n          const newToken = Math.random().toString(36).substring(2);\n          await env.KV\u6570\u636E\u5E93.put('current_token', newToken, { expirationTtl: 300 });\n          await env.KV\u6570\u636E\u5E93.put(`fail_${deviceId}`, '0');\n          return createRedirectResponse(`/${CONFIG_PATH}`, {\n            'Set-Cookie': `token=${newToken}; Path=/; HttpOnly; SameSite=Strict`\n          });\n        }\n\n        let failureCount = Number(await env.KV\u6570\u636E\u5E93.get(`fail_${deviceId}`) || 0) + 1;\n        await env.KV\u6570\u636E\u5E93.put(`fail_${deviceId}`, String(failureCount));\n\n        if (failureCount >= MAX_FAILURES) {\n          await env.KV\u6570\u636E\u5E93.put(`lock_${deviceId}`, String(Date.now() + LOCK_TIME), { expirationTtl: 300 });\n          const newLockStatus = await checkLock(env, deviceId, LOCK_TIME);\n          return createHTMLResponse(generateLoginRegisterPage('\u767B\u5F55', {\n            \u9501\u5B9A\u72B6\u6001: true,\n            \u5269\u4F59\u65F6\u95F4: newLockStatus.\u5269\u4F59\u65F6\u95F4\n          }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 403);\n        }\n\n        return createHTMLResponse(generateLoginRegisterPage('\u767B\u5F55', {\n          \u8F93\u9519\u5BC6\u7801: true,\n          \u5269\u4F59\u6B21\u6570: MAX_FAILURES - failureCount\n        }, LIGHT_BG_IMAGE, DARK_BG_IMAGE), 401);\n      }\n\n      // \u68C0\u67E5\u662F\u5426\u5DF2\u6CE8\u518C\n      const isRegistered = await env.KV\u6570\u636E\u5E93.get('stored_credentials');\n      if (!isRegistered && url.pathname !== '/register') {\n        return createHTMLResponse(generateLoginRegisterPage('\u6CE8\u518C', {}, LIGHT_BG_IMAGE, DARK_BG_IMAGE));\n      }\n\n      // \u8DEF\u7531\u5904\u7406\n      switch (url.pathname) {\n        case '/login':\n          const storedCredentials = await env.KV\u6570\u636E\u5E93.get('stored_credentials');\n          if (!storedCredentials) {\n            return createRedirectResponse('/register');\n          }\n\n          const lockStatus = await checkLock(env, deviceId, LOCK_TIME);\n          if (lockStatus.\u88AB\u9501\u5B9A) {\n            return createHTMLResponse(generateLoginRegisterPage('\u767B\u5F55', { \u9501\u5B9A\u72B6\u6001: true, \u5269\u4F59\u65F6\u95F4: lockStatus.\u5269\u4F59\u65F6\u95F4 }, LIGHT_BG_IMAGE, DARK_BG_IMAGE));\n          }\n          if (request.headers.get('Cookie')?.split('=')[1] === await env.KV\u6570\u636E\u5E93.get('current_token')) {\n            return createRedirectResponse(`/${CONFIG_PATH}`);\n          }\n          const failureCount = Number(await env.KV\u6570\u636E\u5E93.get(`fail_${deviceId}`) || 0);\n          return createHTMLResponse(generateLoginRegisterPage('\u767B\u5F55', { \u8F93\u9519\u5BC6\u7801: failureCount > 0, \u5269\u4F59\u6B21\u6570: MAX_FAILURES - failureCount }, LIGHT_BG_IMAGE, DARK_BG_IMAGE));\n\n        case '/reset-login-failures':\n          await env.KV\u6570\u636E\u5E93.put(`fail_${deviceId}`, '0');\n          await env.KV\u6570\u636E\u5E93.delete(`lock_${deviceId}`);\n          return new Response(null, { status: 200 });\n\n        case '/check-lock':\n          const lockCheck = await checkLock(env, deviceId, LOCK_TIME);\n          return createJSONResponse({\n            locked: lockCheck.\u88AB\u9501\u5B9A,\n            remainingTime: lockCheck.\u5269\u4F59\u65F6\u95F4\n          });\n\n        case `/${CONFIG_PATH}`:\n          const token = request.headers.get('Cookie')?.split('=')[1];\n          const validToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!token || token !== validToken) return createRedirectResponse('/login');\n          const uuid = await getOrInitializeUUID(env);\n          return createHTMLResponse(generateSubscriptionPage(CONFIG_PATH, hostName, uuid, LIGHT_BG_IMAGE, DARK_BG_IMAGE));\n\n        case `/${CONFIG_PATH}/logout`:\n          await env.KV\u6570\u636E\u5E93.delete('current_token');\n          return createRedirectResponse('/login', { 'Set-Cookie': 'token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; SameSite=Strict' });\n\n        case `/${CONFIG_PATH}/` + atob('Y2xhc2g='):\n          await loadNodesAndConfig(env, hostName, PREFERRED_NODES, NODE_NAME);\n          const catConfig = await getConfig(env, atob('Y2xhc2g='), hostName, generateCatConfig);\n          return new Response(catConfig, { status: 200, headers: { \"Content-Type\": \"text/plain;charset=utf-8\" } });\n\n        case `/${CONFIG_PATH}/` + atob('djJyYXluZw=='):\n          await loadNodesAndConfig(env, hostName, PREFERRED_NODES, NODE_NAME);\n          const universalConfig = await getConfig(env, atob('djJyYXk='), hostName, generateUniversalConfig);\n          return new Response(universalConfig, { status: 200, headers: { \"Content-Type\": \"text/plain;charset=utf-8\" } });\n\n        case `/${CONFIG_PATH}/upload`:\n          const uploadToken = request.headers.get('Cookie')?.split('=')[1];\n          const validUploadToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!uploadToken || uploadToken !== validUploadToken) {\n            return createJSONResponse({ error: '\u672A\u767B\u5F55\u6216Token\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55' }, 401);\n          }\n          formData = await request.formData();\n          const ipFiles = formData.getAll('ipFiles');\n          if (!ipFiles || ipFiles.length === 0) {\n            return createJSONResponse({ error: '\u672A\u9009\u62E9\u4EFB\u4F55\u6587\u4EF6' }, 400);\n          }\n          let allIpList = [];\n          try {\n            for (const ipFile of ipFiles) {\n              if (!ipFile || !ipFile.text) throw new Error(`\u6587\u4EF6 ${ipFile.name} \u65E0\u6548`);\n              const ipText = await ipFile.text();\n              const ipList = ipText.split('\\n').map(line => line.trim()).filter(Boolean);\n              if (ipList.length === 0) console.warn(`\u6587\u4EF6 ${ipFile.name} \u5185\u5BB9\u4E3A\u7A7A`);\n              allIpList = allIpList.concat(ipList);\n            }\n            if (allIpList.length === 0) {\n              return createJSONResponse({ error: '\u6240\u6709\u4E0A\u4F20\u6587\u4EF6\u5185\u5BB9\u4E3A\u7A7A' }, 400);\n            }\n            const uniqueIpList = [...new Set(allIpList)];\n\n            const currentManualNodes = await env.KV\u6570\u636E\u5E93.get('manual_preferred_ips');\n            const currentNodeList = currentManualNodes ? JSON.parse(currentManualNodes) : [];\n            const isDuplicateUpload = JSON.stringify(currentNodeList.sort()) === JSON.stringify(uniqueIpList.sort());\n            if (isDuplicateUpload) {\n              return createJSONResponse({ message: '\u4E0A\u4F20\u5185\u5BB9\u4E0E\u73B0\u6709\u8282\u70B9\u76F8\u540C\uFF0C\u65E0\u9700\u66F4\u65B0' }, 200);\n            }\n\n            await env.KV\u6570\u636E\u5E93.put('manual_preferred_ips', JSON.stringify(uniqueIpList));\n            const newVersion = String(Date.now());\n            await env.KV\u6570\u636E\u5E93.put('ip_preferred_ips_version', newVersion);\n            await env.KV\u6570\u636E\u5E93.put('config_' + atob('Y2xhc2g='), await generateCatConfig(env, hostName, PREFERRED_NODES, NODE_NAME));\n            await env.KV\u6570\u636E\u5E93.put('config_' + atob('Y2xhc2g=') + '_version', newVersion);\n            await env.KV\u6570\u636E\u5E93.put('config_' + atob('djJyYXk='), await generateUniversalConfig(env, hostName, PREFERRED_NODES, NODE_NAME));\n            await env.KV\u6570\u636E\u5E93.put('config_' + atob('djJyYXk=') + '_version', newVersion);\n            return createJSONResponse({ message: '\u4E0A\u4F20\u6210\u529F\uFF0C\u5373\u5C06\u8DF3\u8F6C' }, 200, { 'Location': `/${CONFIG_PATH}` });\n          } catch (error) {\n            console.error(`\u4E0A\u4F20\u5904\u7406\u5931\u8D25: ${error.message}`);\n            return createJSONResponse({ error: `\u4E0A\u4F20\u5904\u7406\u5931\u8D25: ${error.message}` }, 500);\n          }\n\n        case `/${CONFIG_PATH}/change-uuid`:\n          const changeToken = request.headers.get('Cookie')?.split('=')[1];\n          const validChangeToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!changeToken || changeToken !== validChangeToken) {\n            return createJSONResponse({ error: '\u672A\u767B\u5F55\u6216Token\u65E0\u6548' }, 401);\n          }\n          const newUUID = generateUUID();\n          await env.KV\u6570\u636E\u5E93.put('current_uuid', newUUID);\n          await env.KV\u6570\u636E\u5E93.put('config_' + atob('Y2xhc2g='), await generateCatConfig(env, hostName, PREFERRED_NODES, NODE_NAME));\n          await env.KV\u6570\u636E\u5E93.put('config_' + atob('djJyYXk='), await generateUniversalConfig(env, hostName, PREFERRED_NODES, NODE_NAME));\n          const newVersion = String(Date.now());\n          await env.KV\u6570\u636E\u5E93.put('config_' + atob('Y2xhc2g=') + '_version', newVersion);\n          await env.KV\u6570\u636E\u5E93.put('config_' + atob('djJyYXk=') + '_version', newVersion);\n          return createJSONResponse({ uuid: newUUID }, 200);\n\n        case `/${CONFIG_PATH}/add-node-path`:\n          const addToken = request.headers.get('Cookie')?.split('=')[1];\n          const validAddToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!addToken || addToken !== validAddToken) {\n            return createJSONResponse({ error: '\u672A\u767B\u5F55\u6216Token\u65E0\u6548' }, 401);\n          }\n          const addData = await request.json();\n          const newPath = addData.path;\n          if (!newPath || !newPath.match(/^https?:\\/\\//)) {\n            return createJSONResponse({ error: '\u65E0\u6548\u7684URL\u683C\u5F0F' }, 400);\n          }\n          let currentPaths = await env.KV\u6570\u636E\u5E93.get('node_file_paths');\n          currentPaths = currentPaths ? JSON.parse(currentPaths) : [];\n          if (currentPaths.includes(newPath)) {\n            return createJSONResponse({ error: '\u8BE5\u8DEF\u5F84\u5DF2\u5B58\u5728' }, 400);\n          }\n          currentPaths.push(newPath);\n          await env.KV\u6570\u636E\u5E93.put('node_file_paths', JSON.stringify(currentPaths));\n          await loadNodesAndConfig(env, hostName, PREFERRED_NODES, NODE_NAME);\n          return createJSONResponse({ success: true }, 200);\n\n        case `/${CONFIG_PATH}/remove-node-path`:\n          const removeToken = request.headers.get('Cookie')?.split('=')[1];\n          const validRemoveToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!removeToken || removeToken !== validRemoveToken) {\n            return createJSONResponse({ error: '\u672A\u767B\u5F55\u6216Token\u65E0\u6548' }, 401);\n          }\n          const removeData = await request.json();\n          const index = removeData.index;\n          let paths = await env.KV\u6570\u636E\u5E93.get('node_file_paths');\n          paths = paths ? JSON.parse(paths) : [];\n          if (index < 0 || index >= paths.length) {\n            return createJSONResponse({ error: '\u65E0\u6548\u7684\u7D22\u5F15' }, 400);\n          }\n          paths.splice(index, 1);\n          await env.KV\u6570\u636E\u5E93.put('node_file_paths', JSON.stringify(paths));\n          await loadNodesAndConfig(env, hostName, PREFERRED_NODES, NODE_NAME);\n          return createJSONResponse({ success: true }, 200);\n\n        case `/${CONFIG_PATH}/get-node-paths`:\n          const getToken = request.headers.get('Cookie')?.split('=')[1];\n          const validGetToken = await env.KV\u6570\u636E\u5E93.get('current_token');\n          if (!getToken || getToken !== validGetToken) {\n            return createJSONResponse({ error: '\u672A\u767B\u5F55\u6216Token\u65E0\u6548' }, 401);\n          }\n          let nodePaths = await env.KV\u6570\u636E\u5E93.get('node_file_paths');\n          nodePaths = nodePaths ? JSON.parse(nodePaths) : ['https://v2.i-sweet.us.kg/ips.txt', 'https://v2.i-sweet.us.kg/url.txt'];\n          return createJSONResponse({ paths: nodePaths }, 200);\n\n        case '/set-proxy-state':\n          formData = await request.formData();\n          const proxyEnabled = formData.get('proxyEnabled');\n          const proxyType = formData.get('proxyType');\n          const forceProxy = formData.get('forceProxy');\n          await env.KV\u6570\u636E\u5E93.put('proxyEnabled', proxyEnabled);\n          await env.KV\u6570\u636E\u5E93.put('proxyType', proxyType);\n          await env.KV\u6570\u636E\u5E93.put('forceProxy', forceProxy);\n          return new Response(null, { status: 200 });\n\n        case '/get-proxy-status':\n          const currentProxyEnabled = await env.KV\u6570\u636E\u5E93.get('proxyEnabled') === 'true';\n          const currentProxyType = await env.KV\u6570\u636E\u5E93.get('proxyType') || 'reverse';\n          const currentForceProxy = await env.KV\u6570\u636E\u5E93.get('forceProxy') === 'true';\n          const proxyAddress = env.PROXYIP || 'ts.hpc.tw';\n          const socks5Account = env.SOCKS5 || '';\n          let status = '\u76F4\u8FDE';\n          if (currentProxyEnabled) {\n            if (currentForceProxy) {\n              status = currentProxyType === 'reverse' && proxyAddress ? '\u5F3A\u5236\u53CD\u4EE3' : '\u5F3A\u5236SOCKS5';\n            } else if (currentProxyType === 'reverse' && proxyAddress) {\n              status = '\u52A8\u6001\u53CD\u4EE3';\n            } else if (currentProxyType === 'socks5' && socks5Account) {\n              status = '\u52A8\u6001SOCKS5';\n            }\n          }\n          return createJSONResponse({ status });\n\n        default:\n          url.hostname = FAKE_DOMAIN;\n          url.protocol = 'https:';\n          return fetch(new Request(url, request));\n      }\n    } catch (error) {\n      console.error(`\u5168\u5C40\u9519\u8BEF: ${error.message}`);\n      return createJSONResponse({ error: `\u670D\u52A1\u5668\u5185\u90E8\u9519\u8BEF: ${error.message}` }, 500);\n    }\n  }\n};\n\n// \u8F85\u52A9\u51FD\u6570\nfunction generateUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}"],
  "mappings": "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",
  "names": ["newVersion", "generateUUID"]
}
